{% extends "base.html" %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Header du module -->
    <div class="mb-8">
        <div class="flex items-center gap-3 mb-4">
            {% if module.pillar == 'applications' %}
                <span class="px-3 py-1 bg-pillar-app/20 text-pillar-app rounded-full text-sm font-medium">üîó Applications</span>
            {% elif module.pillar == 'events' %}
                <span class="px-3 py-1 bg-pillar-event/20 text-pillar-event rounded-full text-sm font-medium">‚ö° √âv√©nements</span>
            {% elif module.pillar == 'data' %}
                <span class="px-3 py-1 bg-pillar-data/20 text-pillar-data rounded-full text-sm font-medium">üìä Donn√©es</span>
            {% elif module.pillar == 'cross_cutting' %}
                <span class="px-3 py-1 bg-pillar-cross/20 text-pillar-cross rounded-full text-sm font-medium">üõ°Ô∏è Transversal</span>
            {% else %}
                <span class="px-3 py-1 bg-gray-700 text-gray-300 rounded-full text-sm font-medium">üìö Fondations</span>
            {% endif %}
            <span class="text-gray-500">Module {{ module.id }}</span>
        </div>
        <h1 class="text-3xl font-bold text-white mb-4">{{ module.title }}</h1>
    </div>

    <!-- Contenu du module -->
    <div class="bg-gray-800 rounded-lg p-8 border border-gray-700 prose-content text-gray-300">
        {{ module.content | safe if module.content else '<p class="text-gray-400 italic">Contenu en cours de r√©daction...</p>' }}
    </div>

    <!-- Navigation entre modules -->
    <div class="flex justify-between items-center mt-8">
        {% if module.id > 1 %}
            <a href="/theory/modules/{{ module.id - 1 }}" class="flex items-center gap-2 px-4 py-2 bg-gray-800 rounded-lg border border-gray-700 hover:border-gray-600 transition-colors">
                <i data-lucide="chevron-left" class="w-4 h-4"></i>
                <span>Module pr√©c√©dent</span>
            </a>
        {% else %}
            <div></div>
        {% endif %}

        <button onclick="completeModule({{ module.id }})" class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg font-medium transition-colors">
            Marquer comme termin√©
        </button>

        {% if module.id < 16 %}
            <a href="/theory/modules/{{ module.id + 1 }}" class="flex items-center gap-2 px-4 py-2 bg-gray-800 rounded-lg border border-gray-700 hover:border-gray-600 transition-colors">
                <span>Module suivant</span>
                <i data-lucide="chevron-right" class="w-4 h-4"></i>
            </a>
        {% else %}
            <div></div>
        {% endif %}
    </div>

    <!-- Sc√©narios li√©s -->
    <div class="mt-12">
        <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
            <i data-lucide="play-circle" class="w-5 h-5 text-orange-500"></i>
            Sc√©narios pratiques
        </h2>
        <div id="related-scenarios" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Charg√© dynamiquement -->
        </div>
    </div>
</div>

<script>
    async function completeModule(moduleId) {
        try {
            const response = await fetch(`/api/theory/modules/${moduleId}/complete`, {
                method: 'POST'
            });
            if (response.ok) {
                showToast('Module marqu√© comme termin√© !', 'success');
            }
        } catch (e) {
            showToast('Erreur lors de la mise √† jour', 'error');
        }
    }

    async function loadRelatedScenarios() {
        try {
            const response = await fetch('/api/sandbox/scenarios');
            const scenarios = await response.json();
            const container = document.getElementById('related-scenarios');

            // Filtrer par pilier si applicable
            const pillar = '{{ module.pillar or "" }}';
            const filtered = pillar
                ? scenarios.filter(s => s.pillar === pillar).slice(0, 4)
                : scenarios.slice(0, 4);

            if (filtered.length === 0) {
                container.innerHTML = '<p class="text-gray-500 col-span-2">Aucun sc√©nario associ√© pour le moment.</p>';
                return;
            }

            container.innerHTML = filtered.map(s => `
                <a href="/sandbox?scenario=${s.id}" class="bg-gray-800 rounded-lg p-4 border border-gray-700 hover:border-gray-600 transition-all">
                    <div class="flex items-start justify-between mb-2">
                        <span class="font-medium text-white">${s.title}</span>
                        <span class="text-xs px-2 py-1 bg-gray-700 rounded-full text-gray-400">${s.id}</span>
                    </div>
                    <p class="text-sm text-gray-400">${s.description}</p>
                    <div class="mt-3 flex items-center gap-2 text-xs text-gray-500">
                        <span>${s.steps.length} √©tapes</span>
                        <span>‚Ä¢</span>
                        <span>${'‚≠ê'.repeat(s.complexity)}</span>
                    </div>
                </a>
            `).join('');
        } catch (e) {
            console.error('Erreur chargement sc√©narios:', e);
        }
    }

    // Initialiser
    document.addEventListener('DOMContentLoaded', () => {
        loadRelatedScenarios();
        lucide.createIcons();
    });
</script>
{% endblock %}
